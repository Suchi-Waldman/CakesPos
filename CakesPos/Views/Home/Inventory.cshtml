@model CakesPos.Data.InventoryByCategoryModel


@section Styles{
    <link href="~/Content/themes/orderStyles.css" rel="stylesheet" />
}


<div class="container" id="inventoryContainer">
    <div>
        <form action="/home/Inventory" method="POST">
            <div class="form-group">
                <label>
                    From
                    <input type="date" class="form-control invDate" name="min" />
                </label>
                <label>
                    To
                    <input type="date" class="form-control invDate" name="max" />
                </label>
                <button id="invRefresh" class="btn btn-default" type="submit"><span class="glyphicon glyphicon-refresh"></span></button>
            </div>
        </form>
    </div>
    @foreach (CakesPos.Data.Category category in Model.categories)
    {
        <div class="panel panel-default info-panel">
            <div class="panel-heading">
                @category.CategoryName
            </div>
            <div class="panel-body">
                <table class="table table-condensed table-bordered table-responsive table-hover table-striped" id="inventoryTable">
                    <tr>
                        <th class="thInv" id="invProductCell">Product</th>
                        <th class="thInv">Stock</th>
                        <th class="thInv">
                            Requested
                        </th>
                        <th class="thInv">Total Available</th>
                        <th class="thInv">Action</th>
                    </tr>
                    @{var inventory = Model.inventory.Where(i => i.product.CategoryId == category.Id);}
                    @foreach (CakesPos.Data.InventoryViewModel i in inventory)
                    {
                        var requested = i.requestedAmount;
                        var total = i.product.InStock - requested;
                        double p = 100 - ((double)i.requestedAmount / (double)i.product.InStock) * (100);
                        string per = "";
                        string cls = "";
                        if (p == 0)
                        {
                            per = "style=" + "width:2em";
                        }
                        else
                        {
                            per = "style=" + "width:" + p.ToString() + "%"+";min-width:2em;";
                        }

                        if (p >= 85)
                        {
                            cls = "progress-bar progress-bar-success progress-bar-striped";
                        }
                        else if (p < 85 && p > 35)
                        {
                            cls = "progress-bar progress-bar-warning progress-bar-striped";
                        }
                        else
                        {
                            cls = "progress-bar progress-bar-danger progress-bar-striped";
                        }

                        <tr>
                            <td>@i.product.ProductName</td>
                            <td class="inStock">@i.product.InStock</td>
                            <td>@i.requestedAmount</td>
                                <td align="center">
                                    <div class="progress" style="width:200px;height:35px;">
                                        <div class="@cls" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" @per>
                                            <div style="margin-top:10px;">
                                                <span style="color:white;font-size:medium;">@total</span>
                                            </div>
                                            <span class="sr-only">100% Complete (success)</span>
                                        </div>
                                    </div>
                                </td>
                            <td align="center">
                                <input type="number" class="invQuantityInput" /> <button class="btn btn-default btn-group add" data-id="@i.product.Id">Add</button>
                            </td>
                        </tr>
                    }
                </table>
            </div>
        </div>
    }
</div>

