@model CakesPos.Data.InventoryByCategoryModel


@section Styles{
    <link href="~/Content/themes/orderStyles.css" rel="stylesheet" />
}


<div class="container" id="inventoryContainer">
    <div>
        <form action="/home/Inventory" method="POST">
            <div class="form-group">
                <label>
                    From
                    <input type="date" class="form-control invDate" name="min" />
                </label>
                <label>
                    To
                    <input type="date" class="form-control invDate" name="max" />
                </label>
                <button id="invRefresh" class="btn btn-default" type="submit"><span class="glyphicon glyphicon-refresh"></span></button>
            </div>
        </form>
    </div>
    @foreach (CakesPos.Data.Category category in Model.categories)
    {
        <div class="panel panel-default info-panel">
            <div class="panel-heading">
                @category.CategoryName
            </div>
            <div class="panel-body">
                <table class="table table-condensed table-bordered table-responsive table-hover table-striped" id="inventoryTable">
                    <tr>
                        <th class="thInv" id="invProductCell">Product</th>
                        <th class="thInv">Stock</th>
                        <th class="thInv">
                            Requested
                            @*<div>*@
                            @*<label>
                                    From
                                    <input type="date" class="form-control invDate" />
                                </label>
                                <label>
                                    To
                                    <input type="date" class="form-control invDate" />
                                </label>*@
                            @*</div>*@
                        </th>
                        <th class="thInv">Total</th>
                        <th class="thInv">Action</th>
                    </tr>
                    @{var inventory = Model.inventory.Where(i => i.product.CategoryId == category.Id);}
                    @foreach (CakesPos.Data.InventoryViewModel i in inventory)
                    {
                        var requested = i.requestedAmount;
                        var total = i.product.InStock - requested;
                        double p = 100 - ((double)i.requestedAmount / (double)i.product.InStock) * (100);
                        string per = "";
                        string cls = "";
                        if (p == 0)
                        {
                            per = "style=" + "width:" + "100%";
                        }
                        else
                        {
                            per = "style=" + "width:" + p.ToString() + "%";
                        }

                        if (p >= 85)
                        {
                            cls = "progress-bar progress-bar-success progress-bar-striped";
                        }
                        else if (p < 85 && p > 35)
                        {
                            cls = "progress-bar progress-bar-warning progress-bar-striped";
                        }
                        else
                        {
                            cls = "progress-bar progress-bar-danger progress-bar-striped";
                        }

                        <tr>
                            <td>@i.product.ProductName</td>
                            <td>@i.product.InStock</td>
                            <td>@i.requestedAmount</td>
                            @if (total < 1)
                            {
                                <td style="text-align:center">
                                    <div class="progress" style="width:200px;height:35px;">
                                        <div class="@cls" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" @per>
                                            <span style="color:red">@total</span>
                                            <span class="sr-only">100% Complete (success)</span>
                                        </div>
                                    </div>
                                </td>
                                @*<td><span style="color:red">@total</span></td>*@
                            }
                            else
                            {
                                <td style="text-align:center">
                                    <div class="progress" style="width:200px;height:35px;">
                                        <div class="@cls" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" @per>
                                            <div style="margin-top:10px;">
                                                <span style="color:white;font-size:medium;">@total</span>
                                            </div>
                                            <span class="sr-only">100% Complete (success)</span>
                                        </div>
                                    </div>
                                </td>
                                @*<td>@total</td>*@
                            }
                            <td>
                                @*<a href="#" class="btn btn-info" data-toggle="popover" data-trigger="focus" title="Popover Header" data-content="Some content inside the popover">Update Inventory</a>*@
                                <input type="number" class="invQuantityInput" /> <button class="btn btn-default btn-sm">Add</button>
                                @*<button class="btn btn-info inventoryBtn" data-toggle="modal" data-target="#inventorysModal" data- data-productName="@i.product.ProductName" data-productid=@i.product.Id>Update Inventory</button>*@
                            </td>
                            @*<td><button class="btn btn-info inventoryBtn" data-toggle="modal" data-target="#inventorysModal" data-productid=@i.product.Id>Update Inventory</button></td>*@
                        </tr>
                    }
                </table>
            </div>
        </div>
    }
</div>



<div id="inventorysModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Update Inventory</h4>
            </div>
            <div class="modal-body">
                <h3 id="productNameInv"></h3>
                <h2>Quantity  <input type="number" id="quantityInv" /></h2>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
